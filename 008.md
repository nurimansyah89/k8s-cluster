# Monitor Kluster dengan Kubernetes Dashboard #
Tutorial ini akan membantumu untuk melakukan monitoring kkluster menggunakan kubernetes dashboard.

## Pra-Syarat ##
- Kluster Kubernetes

## Instalasi ##
```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml
```

## Buat User ##
Membuat user dan dapatkan token login:
```bash
vi admin-user.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: <nama-user>
  namespace: kubernetes-dashboard

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: <nama-user>
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: <nama-user>
  namespace: kubernetes-dashboard
```

### Contoh ###
```bash
vi admin-user.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
```

Kemudian, untuk membuat tokennya:
```bash
kubectl -n kubernetes-dashboard create token admin-user
```

Apabila kamu lupa tokenmu, kamu dapat membuat baru token tersebut. Hal ini dikarenakan, batas expired token adalah 1 hari.

## Mengakses Dashboard ##
Untuk mengakses dashboard, dapat dilakukan dengan 2 cara:
- [Menggunakan Proxy](#menggunakan-proxy)
- [Menggunakan Ingress](#menggunakan-ingress-recommended)

### Menggunakan Proxy ###
Setelah langkah di atas terpenuh, jalankan perintah ini:
```bash
kubectl proxy
```

Biarkan cmd/terminal running, lalu kamu dapat mengakses dashboard pada url berikut:

http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/

Untuk mengakhiri service, tekan `ctl+d`.

> Cara ini hanya temporari dan membutuhkan sedikit effort untuk mengakses dashboard. Disarankan menggunakan ingress jika ingin menjadikan permanen.

### Menggunakan Ingress (Recommended) ###
Cara ini adalah cara yang direkomendasikan apabila kamu ingin melakukan sharing dashboard (public/private).

Berikut adalah langkah-langkahnya:
- Sebelumnya, pastikan kamu sudah menginstall [Cert Manager](./002.md)
- Buat certificate SSL dengan metode *self-sign*. Jika sudah, lanjutkan langkah selanjutnya.
- Cek service dashboard:
```bash
kubectl -n kubernetes-dashboard get svc -o wide
kubectl -n kubernetes-dashboard get pods -o wide
```
- Pastikan semua pod running
- Lalu, buat file ingress:
```yaml
# File: ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kube-dashboard-ingress
  namespace: kubernetes-dashboard
  annotations:
    cert-manager.io/cluster-issuer: "selfsigned-cluster-issuer"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - "hostname"
    secretName: "<nama-secret-dashboard>" # Masukkan nama secret saat generate secret
  rules:
  - host: "hostname" # Isikan dengan nama host yang diinginkan. Misal: "dashboard.k8s.local"
    http:
      paths:
      - pathType: Prefix
        path: "/"
        backend:
          service:
            name: "kubernetes-dashboard"
            port:
              number: 443
```
- Apply:
```bash
kubectl apply -f ingress.yaml
```
- Apabila sudah berhasil, kamu dapat mengunjungi url hostname ingress-mu untuk membuka halaman dashboard kubernetes kluster-mu~~~!!!!